/*! For license information please see test_bundle.js.LICENSE.txt */
(()=>{var e={518:function(e){e.exports=function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(null,arguments)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(a=function(){return!!e})()}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function l(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}function p(e){var t="function"==typeof Map?new Map:void 0;return p=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(a())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&c(o,n.prototype),o}(e,arguments,i(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)},p(e)}var d=Object.create(null);d.open="0",d.close="1",d.ping="2",d.pong="3",d.message="4",d.upgrade="5",d.noop="6";var y=Object.create(null);Object.keys(d).forEach((function(e){y[d[e]]=e}));var g,v={type:"error",data:"parser error"},m="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),_="function"==typeof ArrayBuffer,w=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},E=function(e,t,n){var r=e.type,o=e.data;return m&&o instanceof Blob?t?n(o):C(o,n):_&&(o instanceof ArrayBuffer||w(o))?t?n(o):C(new Blob([o]),n):n(d[r]+(o||""))},C=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function b(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O="undefined"==typeof Uint8Array?[]:new Uint8Array(256),A=0;A<64;A++)O[S.charCodeAt(A)]=A;var R,k="function"==typeof ArrayBuffer,N=function(e,t){if("string"!=typeof e)return{type:"message",data:I(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:T(e.substring(1),t)}:y[n]?e.length>1?{type:y[n],data:e.substring(1)}:{type:y[n]}:v},T=function(e,t){if(k){var n=function(e){var t,n,r,o,i,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),h=new Uint8Array(u);for(t=0;t<a;t+=4)n=O[e.charCodeAt(t)],r=O[e.charCodeAt(t+1)],o=O[e.charCodeAt(t+2)],i=O[e.charCodeAt(t+3)],h[c++]=n<<2|r>>4,h[c++]=(15&r)<<4|o>>2,h[c++]=(3&o)<<6|63&i;return u}(e);return I(n,t)}return{base64:!0,data:e}},I=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},F=String.fromCharCode(30);function P(){return new TransformStream({transform:function(e,t){!function(e,t){m&&e.data instanceof Blob?e.data.arrayBuffer().then(b).then(t):_&&(e.data instanceof ArrayBuffer||w(e.data))?t(b(e.data)):E(e,!1,(function(e){g||(g=new TextEncoder),t(g.encode(e))}))}(e,(function(n){var r,o=n.length;if(o<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,o);else if(o<65536){r=new Uint8Array(3);var i=new DataView(r.buffer);i.setUint8(0,126),i.setUint16(1,o)}else{r=new Uint8Array(9);var s=new DataView(r.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(o))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}})}function L(e){return e.reduce((function(e,t){return e+t.length}),0)}function x(e,t){if(e[0].length===t)return e.shift();for(var n=new Uint8Array(t),r=0,o=0;o<t;o++)n[o]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function B(e){if(e)return function(e){for(var t in B.prototype)e[t]=B.prototype[t];return e}(e)}B.prototype.on=B.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},B.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},B.prototype.off=B.prototype.removeListener=B.prototype.removeAllListeners=B.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},B.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t)}return this},B.prototype.emitReserved=B.prototype.emit,B.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},B.prototype.hasListeners=function(e){return!!this.listeners(e).length};var M="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},q="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function D(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var j=q.setTimeout,U=q.clearTimeout;function G(e,t){t.useNativeTimers?(e.setTimeoutFn=j.bind(q),e.clearTimeoutFn=U.bind(q)):(e.setTimeoutFn=q.setTimeout.bind(q),e.clearTimeoutFn=q.clearTimeout.bind(q))}function H(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}var z=function(e){function t(t,n,r){var o;return(o=e.call(this,t)||this).description=n,o.context=r,o.type="TransportError",o}return s(t,e),t}(p(Error)),V=function(e){function t(t){var n;return(n=e.call(this)||this).writable=!1,G(n,t),n.opts=t,n.query=t.query,n.socket=t.socket,n.supportsBinary=!t.forceBase64,n}s(t,e);var n=t.prototype;return n.onError=function(t,n,r){return e.prototype.emitReserved.call(this,"error",new z(t,n,r)),this},n.open=function(){return this.readyState="opening",this.doOpen(),this},n.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},n.send=function(e){"open"===this.readyState&&this.write(e)},n.onOpen=function(){this.readyState="open",this.writable=!0,e.prototype.emitReserved.call(this,"open")},n.onData=function(e){var t=N(e,this.socket.binaryType);this.onPacket(t)},n.onPacket=function(t){e.prototype.emitReserved.call(this,"packet",t)},n.onClose=function(t){this.readyState="closed",e.prototype.emitReserved.call(this,"close",t)},n.pause=function(e){},n.createUri=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)},n._hostname=function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"},n._port=function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""},n._query=function(e){var t=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""},t}(B),$=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._polling=!1,t}s(t,e);var r=t.prototype;return r.doOpen=function(){this._poll()},r.pause=function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this._polling||!this.writable){var r=0;this._polling&&(r++,this.once("pollComplete",(function(){--r||n()}))),this.writable||(r++,this.once("drain",(function(){--r||n()})))}else n()},r._poll=function(){this._polling=!0,this.doPoll(),this.emitReserved("poll")},r.onData=function(e){var t=this;(function(e,t){for(var n=e.split(F),r=[],o=0;o<n.length;o++){var i=N(n[o],t);if(r.push(i),"error"===i.type)break}return r})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())},r.doClose=function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)},r.write=function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,r=new Array(n),o=0;e.forEach((function(e,i){E(e,!1,(function(e){r[i]=e,++o===n&&t(r.join(F))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emitReserved("drain")}))}))},r.uri=function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=H()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)},n(t,[{key:"name",get:function(){return"polling"}}])}(V),J=!1;try{J="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}var W=J;function Z(){}var Q=function(e){function t(t){var n;if(n=e.call(this,t)||this,"undefined"!=typeof location){var r="https:"===location.protocol,o=location.port;o||(o=r?"443":"80"),n.xd="undefined"!=typeof location&&t.hostname!==location.hostname||o!==t.port}return n}s(t,e);var n=t.prototype;return n.doWrite=function(e,t){var n=this,r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(function(e,t){n.onError("xhr post error",e,t)}))},n.doPoll=function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,n){e.onError("xhr poll error",t,n)})),this.pollXhr=t},t}($),Y=function(e){function t(t,n,r){var o;return(o=e.call(this)||this).createRequest=t,G(o,r),o._opts=r,o._method=r.method||"GET",o._uri=n,o._data=void 0!==r.data?r.data:null,o._create(),o}s(t,e);var n=t.prototype;return n._create=function(){var e,n=this,r=D(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;var o=this._xhr=this.createRequest(r);try{o.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders)for(var i in o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0),this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&o.setRequestHeader(i,this._opts.extraHeaders[i])}catch(e){}if("POST"===this._method)try{o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{o.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(o),"withCredentials"in o&&(o.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(o.timeout=this._opts.requestTimeout),o.onreadystatechange=function(){var e;3===o.readyState&&(null===(e=n._opts.cookieJar)||void 0===e||e.parseCookies(o.getResponseHeader("set-cookie"))),4===o.readyState&&(200===o.status||1223===o.status?n._onLoad():n.setTimeoutFn((function(){n._onError("number"==typeof o.status?o.status:0)}),0))},o.send(this._data)}catch(e){return void this.setTimeoutFn((function(){n._onError(e)}),0)}"undefined"!=typeof document&&(this._index=t.requestsCount++,t.requests[this._index]=this)},n._onError=function(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)},n._cleanup=function(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=Z,e)try{this._xhr.abort()}catch(e){}"undefined"!=typeof document&&delete t.requests[this._index],this._xhr=null}},n._onLoad=function(){var e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())},n.abort=function(){this._cleanup()},t}(B);function K(){for(var e in Y.requests)Y.requests.hasOwnProperty(e)&&Y.requests[e].abort()}Y.requestsCount=0,Y.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",K):"function"==typeof addEventListener&&addEventListener("onpagehide"in q?"pagehide":"unload",K,!1));var X,ee=(X=ne({xdomain:!1}))&&null!==X.responseType,te=function(e){function t(t){var n;n=e.call(this,t)||this;var r=t&&t.forceBase64;return n.supportsBinary=ee&&!r,n}return s(t,e),t.prototype.request=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(e,{xd:this.xd},this.opts),new Y(ne,this.uri(),e)},t}(Q);function ne(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||W))return new XMLHttpRequest}catch(e){}if(!t)try{return new(q[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}var re="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),oe=function(e){function t(){return e.apply(this,arguments)||this}s(t,e);var r=t.prototype;return r.doOpen=function(){var e=this.uri(),t=this.opts.protocols,n=re?{}:D(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()},r.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}},r.write=function(e){var t=this;this.writable=!1;for(var n=function(){var n=e[r],o=r===e.length-1;E(n,t.supportsBinary,(function(e){try{t.doWrite(n,e)}catch(e){}o&&M((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()},r.doClose=function(){void 0!==this.ws&&(this.ws.onerror=function(){},this.ws.close(),this.ws=null)},r.uri=function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=H()),this.supportsBinary||(t.b64=1),this.createUri(e,t)},n(t,[{key:"name",get:function(){return"websocket"}}])}(V),ie=q.WebSocket||q.MozWebSocket,se=function(e){function t(){return e.apply(this,arguments)||this}s(t,e);var n=t.prototype;return n.createSocket=function(e,t,n){return re?new ie(e,t,n):t?new ie(e,t):new ie(e)},n.doWrite=function(e,t){this.ws.send(t)},t}(oe),ae=function(e){function t(){return e.apply(this,arguments)||this}s(t,e);var r=t.prototype;return r.doOpen=function(){var e=this;try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this._transport.ready.then((function(){e._transport.createBidirectionalStream().then((function(t){var n=function(e,t){R||(R=new TextDecoder);var n=[],r=0,o=-1,i=!1;return new TransformStream({transform:function(s,a){for(n.push(s);;){if(0===r){if(L(n)<1)break;var c=x(n,1);i=!(128&~c[0]),o=127&c[0],r=o<126?3:126===o?1:2}else if(1===r){if(L(n)<2)break;var u=x(n,2);o=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),r=3}else if(2===r){if(L(n)<8)break;var h=x(n,8),f=new DataView(h.buffer,h.byteOffset,h.length),l=f.getUint32(0);if(l>Math.pow(2,21)-1){a.enqueue(v);break}o=l*Math.pow(2,32)+f.getUint32(4),r=3}else{if(L(n)<o)break;var p=x(n,o);a.enqueue(N(i?p:R.decode(p),t)),r=0}if(0===o||o>e){a.enqueue(v);break}}}})}(Number.MAX_SAFE_INTEGER,e.socket.binaryType),r=t.readable.pipeThrough(n).getReader(),o=P();o.readable.pipeTo(t.writable),e._writer=o.writable.getWriter();!function t(){r.read().then((function(n){var r=n.done,o=n.value;r||(e.onPacket(o),t())})).catch((function(e){}))}();var i={type:"open"};e.query.sid&&(i.data='{"sid":"'.concat(e.query.sid,'"}')),e._writer.write(i).then((function(){return e.onOpen()}))}))}))},r.write=function(e){var t=this;this.writable=!1;for(var n=function(){var n=e[r],o=r===e.length-1;t._writer.write(n).then((function(){o&&M((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()},r.doClose=function(){var e;null===(e=this._transport)||void 0===e||e.close()},n(t,[{key:"name",get:function(){return"webtransport"}}])}(V),ce={websocket:se,webtransport:ae,polling:te},ue=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,he=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function fe(e){if(e.length>8e3)throw"URI too long";var t,n,r,o,i,s=e,a=e.indexOf("["),c=e.indexOf("]");-1!=a&&-1!=c&&(e=e.substring(0,a)+e.substring(a,c).replace(/:/g,";")+e.substring(c,e.length));for(var u=ue.exec(e||""),h={},f=14;f--;)h[he[f]]=u[f]||"";return-1!=a&&-1!=c&&(h.source=s,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=!0),h.pathNames=(r=h.path,o=/\/{2,9}/g,i=r.replace(o,"/").split("/"),"/"!=r.slice(0,1)&&0!==r.length||i.splice(0,1),"/"==r.slice(-1)&&i.splice(i.length-1,1),i),h.queryKey=(t=h.query,n={},t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n),h}var le="function"==typeof addEventListener&&"function"==typeof removeEventListener,pe=[];le&&addEventListener("offline",(function(){pe.forEach((function(e){return e()}))}),!1);var de=function(e){function t(t,n){var r;if((r=e.call(this)||this).binaryType="arraybuffer",r.writeBuffer=[],r._prevBufferLen=0,r._pingInterval=-1,r._pingTimeout=-1,r._maxPayload=-1,r._pingTimeoutTime=1/0,t&&"object"===f(t)&&(n=t,t=null),t){var i=fe(t);n.hostname=i.host,n.secure="https"===i.protocol||"wss"===i.protocol,n.port=i.port,i.query&&(n.query=i.query)}else n.host&&(n.hostname=fe(n.host).host);return G(r,n),r.secure=null!=n.secure?n.secure:"undefined"!=typeof location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=r.secure?"443":"80"),r.hostname=n.hostname||("undefined"!=typeof location?location.hostname:"localhost"),r.port=n.port||("undefined"!=typeof location&&location.port?location.port:r.secure?"443":"80"),r.transports=[],r._transportsByName={},n.transports.forEach((function(e){var t=e.prototype.name;r.transports.push(t),r._transportsByName[t]=e})),r.opts=o({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),r.opts.path=r.opts.path.replace(/\/$/,"")+(r.opts.addTrailingSlash?"/":""),"string"==typeof r.opts.query&&(r.opts.query=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}(r.opts.query)),le&&(r.opts.closeOnBeforeunload&&(r._beforeunloadEventListener=function(){r.transport&&(r.transport.removeAllListeners(),r.transport.close())},addEventListener("beforeunload",r._beforeunloadEventListener,!1)),"localhost"!==r.hostname&&(r._offlineEventListener=function(){r._onClose("transport close",{description:"network connection lost"})},pe.push(r._offlineEventListener))),r.opts.withCredentials&&(r._cookieJar=void 0),r._open(),r}s(t,e);var n=t.prototype;return n.createTransport=function(e){var t=o({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=o({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)},n._open=function(){var e=this;if(0!==this.transports.length){var n=this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";var r=this.createTransport(n);r.open(),this.setTransport(r)}else this.setTimeoutFn((function(){e.emitReserved("error","No transports available")}),0)},n.setTransport=function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(function(e){return t._onClose("transport close",e)}))},n.onOpen=function(){this.readyState="open",t.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()},n._onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":var t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}},n.onHandshake=function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()},n._resetPingTimeout=function(){var e=this;this.clearTimeoutFn(this._pingTimeoutTimer);var t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn((function(){e._onClose("ping timeout")}),t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()},n._onDrain=function(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()},n.flush=function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}},n._getWritablePackets=function(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e=1,t=0;t<this.writeBuffer.length;t++){var n=this.writeBuffer[t].data;if(n&&(e+="string"==typeof(r=n)?function(e){for(var t=0,n=0,r=0,o=e.length;r<o;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(r):Math.ceil(1.33*(r.byteLength||r.size))),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}var r;return this.writeBuffer},n._hasPingExpired=function(){var e=this;if(!this._pingTimeoutTime)return!0;var t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,M((function(){e._onClose("ping timeout")}),this.setTimeoutFn)),t},n.write=function(e,t,n){return this._sendPacket("message",e,t,n),this},n.send=function(e,t,n){return this._sendPacket("message",e,t,n),this},n._sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},n.close=function(){var e=this,t=function(){e._onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},r=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?r():t()})):this.upgrading?r():t()),this},n._onError=function(e){if(t.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)},n._onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),le&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){var n=pe.indexOf(this._offlineEventListener);-1!==n&&pe.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}},t}(B);de.protocol=4;var ye=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._upgrades=[],t}s(t,e);var n=t.prototype;return n.onOpen=function(){if(e.prototype.onOpen.call(this),"open"===this.readyState&&this.opts.upgrade)for(var t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])},n._probe=function(e){var t=this,n=this.createTransport(e),r=!1;de.priorWebsocketSuccess=!1;var o=function(){r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(function(e){if(!r)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",n),!n)return;de.priorWebsocketSuccess="websocket"===n.name,t.transport.pause((function(){r||"closed"!==t.readyState&&(h(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=n.name,t.emitReserved("upgradeError",o)}})))};function i(){r||(r=!0,h(),n.close(),n=null)}var s=function(e){var r=new Error("probe error: "+e);r.transport=n.name,i(),t.emitReserved("upgradeError",r)};function a(){s("transport closed")}function c(){s("socket closed")}function u(e){n&&e.name!==n.name&&i()}var h=function(){n.removeListener("open",o),n.removeListener("error",s),n.removeListener("close",a),t.off("close",c),t.off("upgrading",u)};n.once("open",o),n.once("error",s),n.once("close",a),this.once("close",c),this.once("upgrading",u),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){r||n.open()}),200):n.open()},n.onHandshake=function(t){this._upgrades=this._filterUpgrades(t.upgrades),e.prototype.onHandshake.call(this,t)},n._filterUpgrades=function(e){for(var t=[],n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t},t}(de),ge=function(e){function t(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="object"===f(t)?t:n;return(!r.transports||r.transports&&"string"==typeof r.transports[0])&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map((function(e){return ce[e]})).filter((function(e){return!!e}))),e.call(this,t,r)||this}return s(t,e),t}(ye);function ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}ge.protocol;var me,_e,we={exports:{}};function Ee(){if(_e)return me;_e=1;var e=1e3,t=60*e,n=60*t,r=24*n,o=7*r;function i(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}return me=function(s,a){a=a||{};var c=f(s);if("string"===c&&s.length>0)return function(i){if(!((i=String(i)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(s){var a=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*o;case"days":case"day":case"d":return a*r;case"hours":case"hour":case"hrs":case"hr":case"h":return a*n;case"minutes":case"minute":case"mins":case"min":case"m":return a*t;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(s);if("number"===c&&isFinite(s))return a.long?function(o){var s=Math.abs(o);return s>=r?i(o,s,r,"day"):s>=n?i(o,s,n,"hour"):s>=t?i(o,s,t,"minute"):s>=e?i(o,s,e,"second"):o+" ms"}(s):function(o){var i=Math.abs(o);return i>=r?Math.round(o/r)+"d":i>=n?Math.round(o/n)+"h":i>=t?Math.round(o/t)+"m":i>=e?Math.round(o/e)+"s":o+"ms"}(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))}}var Ce=function(e){function t(e){var r,o,i,s=null;function a(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(a.enabled){var i=a,s=Number(new Date),c=s-(r||s);i.diff=c,i.prev=r,i.curr=s,r=s,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var u=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";u++;var o=t.formatters[r];if("function"==typeof o){var s=n[u];e=o.call(i,s),n.splice(u,1),u--}return e})),t.formatArgs.call(i,n),(i.log||t.log).apply(i,n)}}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i)},set:function(e){s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(u(t.names.map(r)),u(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Ee(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))})),t.splice(o,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=Ce(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(we,we.exports);var be=ve(we.exports),Se=be("socket.io-client:url");var Oe="function"==typeof ArrayBuffer,Ae=Object.prototype.toString,Re="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Ae.call(Blob),ke="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Ae.call(File);function Ne(e){return Oe&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))||Re&&e instanceof Blob||ke&&e instanceof File}function Te(e,t){if(!e||"object"!==f(e))return!1;if(Array.isArray(e)){for(var n=0,r=e.length;n<r;n++)if(Te(e[n]))return!0;return!1}if(Ne(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Te(e.toJSON(),!0);for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&Te(e[o]))return!0;return!1}function Ie(e){var t=[],n=e.data,r=e;return r.data=Fe(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Fe(e,t){if(!e)return e;if(Ne(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){for(var r=new Array(e.length),o=0;o<e.length;o++)r[o]=Fe(e[o],t);return r}if("object"===f(e)&&!(e instanceof Date)){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=Fe(e[s],t));return i}return e}function Pe(e,t){return e.data=Le(e.data,t),delete e.attachments,e}function Le(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=Le(e[n],t);else if("object"===f(e))for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Le(e[r],t));return e}var xe,Be=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(xe||(xe={}));var Me=function(){function e(e){this.replacer=e}var t=e.prototype;return t.encode=function(e){return e.type!==xe.EVENT&&e.type!==xe.ACK||!Te(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===xe.EVENT?xe.BINARY_EVENT:xe.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})},t.encodeAsString=function(e){var t=""+e.type;return e.type!==xe.BINARY_EVENT&&e.type!==xe.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t},t.encodeAsBinary=function(e){var t=Ie(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r},e}(),qe=function(e){function t(t){var n;return(n=e.call(this)||this).reviver=t,n}s(t,e);var n=t.prototype;return n.add=function(t){var n;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var r=(n=this.decodeString(t)).type===xe.BINARY_EVENT;r||n.type===xe.BINARY_ACK?(n.type=r?xe.EVENT:xe.ACK,this.reconstructor=new De(n),0===n.attachments&&e.prototype.emitReserved.call(this,"decoded",n)):e.prototype.emitReserved.call(this,"decoded",n)}else{if(!Ne(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,e.prototype.emitReserved.call(this,"decoded",n))}},n.decodeString=function(e){var n=0,r={type:Number(e.charAt(0))};if(void 0===xe[r.type])throw new Error("unknown packet type "+r.type);if(r.type===xe.BINARY_EVENT||r.type===xe.BINARY_ACK){for(var o=n+1;"-"!==e.charAt(++n)&&n!=e.length;);var i=e.substring(o,n);if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(n+1)){for(var s=n+1;++n&&","!==e.charAt(n)&&n!==e.length;);r.nsp=e.substring(s,n)}else r.nsp="/";var a=e.charAt(n+1);if(""!==a&&Number(a)==a){for(var c=n+1;++n;){var u=e.charAt(n);if(null==u||Number(u)!=u){--n;break}if(n===e.length)break}r.id=Number(e.substring(c,n+1))}if(e.charAt(++n)){var h=this.tryParse(e.substr(n));if(!t.isPayloadValid(r.type,h))throw new Error("invalid payload");r.data=h}return r},n.tryParse=function(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}},t.isPayloadValid=function(e,t){switch(e){case xe.CONNECT:return Ue(t);case xe.DISCONNECT:return void 0===t;case xe.CONNECT_ERROR:return"string"==typeof t||Ue(t);case xe.EVENT:case xe.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Be.indexOf(t[0]));case xe.ACK:case xe.BINARY_ACK:return Array.isArray(t)}},n.destroy=function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)},t}(B),De=function(){function e(e){this.packet=e,this.buffers=[],this.reconPack=e}var t=e.prototype;return t.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=Pe(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},t.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]},e}();var je=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function Ue(e){return"[object Object]"===Object.prototype.toString.call(e)}var Ge=Object.freeze({__proto__:null,protocol:5,get PacketType(){return xe},Encoder:Me,Decoder:qe,isPacketValid:function(e){return"string"==typeof e.nsp&&(void 0===(t=e.id)||je(t))&&function(e,t){switch(e){case xe.CONNECT:return void 0===t||Ue(t);case xe.DISCONNECT:return void 0===t;case xe.EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Be.indexOf(t[0]));case xe.ACK:return Array.isArray(t);case xe.CONNECT_ERROR:return"string"==typeof t||Ue(t);default:return!1}}(e.type,e.data);var t}});function He(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var ze=be("socket.io-client:socket"),Ve=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),$e=function(e){function t(t,n,r){var i;return(i=e.call(this)||this).connected=!1,i.recovered=!1,i.receiveBuffer=[],i.sendBuffer=[],i._queue=[],i._queueSeq=0,i.ids=0,i.acks={},i.flags={},i.io=t,i.nsp=n,r&&r.auth&&(i.auth=r.auth),i._opts=o({},r),i.io._autoConnect&&i.open(),i}s(t,e);var i=t.prototype;return i.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[He(e,"open",this.onopen.bind(this)),He(e,"packet",this.onpacket.bind(this)),He(e,"error",this.onerror.bind(this)),He(e,"close",this.onclose.bind(this))]}},i.connect=function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this},i.open=function(){return this.connect()},i.send=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this},i.emit=function(e){var t,n,r;if(Ve.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;var a={type:xe.EVENT,data:i,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"==typeof i[i.length-1]){var c=this.ids++;ze("emitting packet with ack id %d",c);var u=i.pop();this._registerAckCallback(c,u),a.id=c}var h=null===(n=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===n?void 0:n.writable,f=this.connected&&!(null===(r=this.io.engine)||void 0===r?void 0:r._hasPingExpired());return this.flags.volatile&&!h?ze("discard packet as the transport is not currently writable"):f?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a),this.flags={},this},i._registerAckCallback=function(e,t){var n,r=this,o=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0!==o){var i=this.io.setTimeoutFn((function(){delete r.acks[e];for(var n=0;n<r.sendBuffer.length;n++)r.sendBuffer[n].id===e&&(ze("removing packet with ack id %d from the buffer",e),r.sendBuffer.splice(n,1));ze("event with ack id %d has timed out after %d ms",e,o),t.call(r,new Error("operation has timed out"))}),o),s=function(){r.io.clearTimeoutFn(i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];t.apply(r,n)};s.withError=!0,this.acks[e]=s}else this.acks[e]=t},i.emitWithAck=function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new Promise((function(n,o){var i=function(e,t){return e?o(e):n(t)};i.withError=!0,r.push(i),t.emit.apply(t,[e].concat(r))}))},i._addToQueue=function(e){var t,n=this;"function"==typeof e[e.length-1]&&(t=e.pop());var r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:o({fromQueue:!0},this.flags)};e.push((function(e){if(r===n._queue[0]){if(null!==e)r.tryCount>n._opts.retries&&(ze("packet [%d] is discarded after %d tries",r.id,r.tryCount),n._queue.shift(),t&&t(e));else if(ze("packet [%d] was successfully sent",r.id),n._queue.shift(),t){for(var o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];t.apply(void 0,[null].concat(i))}return r.pending=!1,n._drainQueue()}})),this._queue.push(r),this._drainQueue()},i._drainQueue=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(ze("draining queue"),this.connected&&0!==this._queue.length){var t=this._queue[0];!t.pending||e?(t.pending=!0,t.tryCount++,ze("sending packet [%d] (try n°%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)):ze("packet [%d] has already been sent and is waiting for an ack",t.id)}},i.packet=function(e){e.nsp=this.nsp,this.io._packet(e)},i.onopen=function(){var e=this;ze("transport is open - connecting"),"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)},i._sendConnectPacket=function(e){this.packet({type:xe.CONNECT,data:this._pid?o({pid:this._pid,offset:this._lastOffset},e):e})},i.onerror=function(e){this.connected||this.emitReserved("connect_error",e)},i.onclose=function(e,t){ze("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()},i._clearAcks=function(){var e=this;Object.keys(this.acks).forEach((function(t){if(!e.sendBuffer.some((function(e){return String(e.id)===t}))){var n=e.acks[t];delete e.acks[t],n.withError&&n.call(e,new Error("socket has been disconnected"))}}))},i.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case xe.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case xe.EVENT:case xe.BINARY_EVENT:this.onevent(e);break;case xe.ACK:case xe.BINARY_ACK:this.onack(e);break;case xe.DISCONNECT:this.ondisconnect();break;case xe.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}},i.onevent=function(e){var t=e.data||[];ze("emitting event %j",t),null!=e.id&&(ze("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))},i.emitEvent=function(t){if(this._anyListeners&&this._anyListeners.length){var n,o=r(this._anyListeners.slice());try{for(o.s();!(n=o.n()).done;)n.value.apply(this,t)}catch(e){o.e(e)}finally{o.f()}}e.prototype.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])},i.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];ze("sending ack %j",o),t.packet({type:xe.ACK,id:e,data:o})}}},i.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(delete this.acks[e.id],ze("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)):ze("bad ack %s",e.id)},i.onconnect=function(e,t){ze("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)},i.emitBuffered=function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]},i.ondisconnect=function(){ze("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.destroy=function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)},i.disconnect=function(){return this.connected&&(ze("performing disconnect (%s)",this.nsp),this.packet({type:xe.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},i.close=function(){return this.disconnect()},i.compress=function(e){return this.flags.compress=e,this},i.timeout=function(e){return this.flags.timeout=e,this},i.onAny=function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this},i.prependAny=function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this},i.offAny=function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this},i.listenersAny=function(){return this._anyListeners||[]},i.onAnyOutgoing=function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this},i.prependAnyOutgoing=function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this},i.offAnyOutgoing=function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this},i.listenersAnyOutgoing=function(){return this._anyOutgoingListeners||[]},i.notifyOutgoingListeners=function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,n=r(this._anyOutgoingListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e.data)}catch(e){n.e(e)}finally{n.f()}}},n(t,[{key:"disconnected",get:function(){return!this.connected}},{key:"active",get:function(){return!!this.subs}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}}])}(B);function Je(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Je.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Je.prototype.reset=function(){this.attempts=0},Je.prototype.setMin=function(e){this.ms=e},Je.prototype.setMax=function(e){this.max=e},Je.prototype.setJitter=function(e){this.jitter=e};var We=be("socket.io-client:manager"),Ze=function(e){function t(t,n){var r,o;(r=e.call(this)||this).nsps={},r.subs=[],t&&"object"===f(t)&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",r.opts=n,G(r,n),r.reconnection(!1!==n.reconnection),r.reconnectionAttempts(n.reconnectionAttempts||1/0),r.reconnectionDelay(n.reconnectionDelay||1e3),r.reconnectionDelayMax(n.reconnectionDelayMax||5e3),r.randomizationFactor(null!==(o=n.randomizationFactor)&&void 0!==o?o:.5),r.backoff=new Je({min:r.reconnectionDelay(),max:r.reconnectionDelayMax(),jitter:r.randomizationFactor()}),r.timeout(null==n.timeout?2e4:n.timeout),r._readyState="closed",r.uri=t;var i=n.parser||Ge;return r.encoder=new i.Encoder,r.decoder=new i.Decoder,r._autoConnect=!1!==n.autoConnect,r._autoConnect&&r.open(),r}s(t,e);var n=t.prototype;return n.reconnection=function(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection},n.reconnectionAttempts=function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)},n.reconnectionDelay=function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)},n.randomizationFactor=function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)},n.reconnectionDelayMax=function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)},n.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},n.maybeReconnectOnOpen=function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},n.open=function(e){var t=this;if(We("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;We("opening %s",this.uri),this.engine=new ge(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var o=He(n,"open",(function(){r.onopen(),e&&e()})),i=function(n){We("error"),t.cleanup(),t._readyState="closed",t.emitReserved("error",n),e?e(n):t.maybeReconnectOnOpen()},s=He(n,"error",i);if(!1!==this._timeout){var a=this._timeout;We("connect attempt will timeout after %d",a);var c=this.setTimeoutFn((function(){We("connect attempt timed out after %d",a),o(),i(new Error("timeout")),n.close()}),a);this.opts.autoUnref&&c.unref(),this.subs.push((function(){t.clearTimeoutFn(c)}))}return this.subs.push(o),this.subs.push(s),this},n.connect=function(e){return this.open(e)},n.onopen=function(){We("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(He(e,"ping",this.onping.bind(this)),He(e,"data",this.ondata.bind(this)),He(e,"error",this.onerror.bind(this)),He(e,"close",this.onclose.bind(this)),He(this.decoder,"decoded",this.ondecoded.bind(this)))},n.onping=function(){this.emitReserved("ping")},n.ondata=function(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}},n.ondecoded=function(e){var t=this;M((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)},n.onerror=function(e){We("error",e),this.emitReserved("error",e)},n.socket=function(e,t){var n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new $e(this,e,t),this.nsps[e]=n),n},n._destroy=function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var r=n[t];if(this.nsps[r].active)return void We("socket %s is still active, skipping close",r)}this._close()},n._packet=function(e){We("writing packet %j",e);for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)},n.cleanup=function(){We("cleanup"),this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()},n._close=function(){We("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")},n.disconnect=function(){return this._close()},n.onclose=function(e,t){var n;We("closed due to %s",e),this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()},n.reconnect=function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)We("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();We("will wait %dms before reconnect attempt",n),this._reconnecting=!0;var r=this.setTimeoutFn((function(){t.skipReconnect||(We("attempting reconnect"),e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(We("reconnect attempt error"),t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):(We("reconnect success"),t.onreconnect())})))}),n);this.opts.autoUnref&&r.unref(),this.subs.push((function(){e.clearTimeoutFn(r)}))}},n.onreconnect=function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)},t}(B),Qe=be("socket.io-client"),Ye={};function Ke(e,t){"object"===f(e)&&(t=e,e=void 0);var n,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(Se("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),Se("parse %s",e),r=fe(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+t,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),o=r.source,i=r.id,s=r.path,a=Ye[i]&&s in Ye[i].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||a?(Qe("ignoring socket cache for %s",o),n=new Ze(o,t)):(Ye[i]||(Qe("new io instance for %s",o),Ye[i]=new Ze(o,t)),n=Ye[i]),r.query&&!t.query&&(t.query=r.queryKey),n.socket(r.path,t)}return o(Ke,{Manager:Ze,Socket:$e,io:Ke,connect:Ke}),Ke}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(()=>{"use strict";const e=class{static EXTENSION_ID="ncmkihhmjnhdkmfemcabkcepadafdehg";static MAIN_STORAGE_PORT="MAIN:STORAGE";static EXTENSION_MAIN_PORT="EXTENSION-MAIN";static STORAGE_SET="STORAGE:SET";static STORAGE_GET="STORAGE:GET";static STUN_SERVERS=["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"];static ICE_CANDIDATE_POOL_SIZE=10;static LOCAL_STREAM_MANIPULATED_EVENT="LOCAL:STREAM_MANIPULATED";static REMOTE_STREAM_MANIPULATED_EVENT="REMOTE:STREAM_MANIPULATED";static EXTENSION_DETAILS="EXTENSION:EXTENSION_DETAILS_TRANSMISSION";static CREATE_SESSION="EXTENSION:CREATE_SESSION";static SESSION_CREATED="SESSION_CREATED";static PLAY="PLAY";static PAUSE="PAUSE";static EXTENSION_MAIN_CONNECTION_ESTABLISHED="EXTENSION-MAIN:ESTABLISHED";static PEER_CONNECTED="PEER_CONNECTED";static SELF_ORGANIZING_OFFER_REQUEST="SELF_ORGANIZING_OFFER_REQUEST";static SELF_ORGANIZING_ANSWER_REQUEST="SELF_ORGANIZING_ANSWER_REQUEST";static SELF_ORGANIZING_ANSWER_RESPONSE="SELF_ORGANIZING_ANSWER_RESPONSE";static SELF_ORGANIZING_OFFER_RESPONSE="SELF_ORGANIZING_OFFER_RESPONSE";static SELF_ORGANIZING_CONNECTION_REQUEST="SELF_ORGANIZING_CONNECTION_REQUEST"};class t{channel=null;pc=null;onOpenAction=()=>console.log("Channel created!");onMessageAction=()=>null;onCloseAction=()=>null;onErrorAction=e=>console.log(e);constructor(e){this.pc=e}Create=(e,t)=>{this.channel=this.pc.createDataChannel(`${e}-${t}`,{reliable:!0}),this.channel.onopen=this.onOpenAction,this.channel.onmessage=this.onMessageAction,this.channel.onerror=this.onErrorAction,this.channel.onclose=this.onCloseAction};Discover=()=>{this.pc.ondatachannel=e=>{this.channel=e.channel,this.channel.onopen=this.onOpenAction,this.channel.onmessage=this.onMessageAction,this.channel.onerror=this.onErrorAction,this.channel.onclose=this.onCloseAction}};SetRemoteStreamEventAction=e=>{this.remoteStreamEventAction=e};SetOnOpenAction=e=>{this.onOpenAction=async()=>await e()};SetOnMessageAction=e=>{this.onMessageAction=async t=>await e(JSON.parse(t.data))};SetOnCloseAction=e=>{this.onCloseAction=async()=>await e()};Send=e=>{if(!this.channel)return null;this.channel.send(JSON.stringify(e))}}const r=class{offer=null;answer=null;peerConnection=null;channel=null;isPrimary=!1;connected=!1;SERVERS={iceServers:[{urls:e.STUN_SERVERS}],iceCandidatePoolSize:10};constructor(e=!1){this.peerConnection=new RTCPeerConnection(this.SERVERS),this.channel=new t(this.peerConnection),this.isPrimary=e,this.peerConnection.addEventListener("connectionstatechange",(()=>{console.log("Connection state changed to:",this.peerConnection.connectionState),this.connected="connected"==this.peerConnection.connectionState,this.connected&&console.log("Peer connection established!")}))}SetLocalDescription=async e=>{await this.peerConnection.setLocalDescription(e)};SetRemoteDescription=async e=>{await this.peerConnection.setRemoteDescription(e)};Offer=async(e,t)=>{this.channel.Create(e,t);const n=await this.peerConnection.createOffer();return await this.SetLocalDescription(n),new Promise((n=>{this.peerConnection.onicecandidate=r=>{null==r.candidate&&(this.offer=this.peerConnection.localDescription,console.log("Your offer is:",this.offer,`id=${e}, suffix=${t}`),n(this.offer))}}))};Answer=async e=>{if(this.peerConnection.remoteDescription)return;const t=new RTCSessionDescription(e);if(this.channel.Discover(),await this.SetRemoteDescription(t),this.offer)return this.answer=this.peerConnection.remoteDescription,this.peerConnection.remoteDescription;this.offer=this.peerConnection.remoteDescription;const n=await this.peerConnection.createAnswer();return await this.SetLocalDescription(n),new Promise((e=>{this.peerConnection.onicecandidate=t=>{null==t.candidate&&(this.answer=this.peerConnection.localDescription,console.log("Your answer is:",this.answer),e(this.peerConnection.localDescription))}}))};SetChannelOnOpenAction=e=>(this.channel.SetOnOpenAction(e),this);SetChannelOnMessageAction=e=>(this.channel.SetOnMessageAction(e),this);SetChannelOnCloseAction=e=>(this.channel.SetOnCloseAction(e),this);Send=e=>{this.channel.Send(e)}},o=class{storagePort=null;constructor(){this.setupStorageChannel()}setupStorageChannel=()=>(this.storagePort=chrome.runtime.connect({name:e.MAIN_STORAGE_PORT}),this.storagePort.postMessage("Connection Established!"),this.extensionPort);Set=(t,n)=>{this.storagePort.postMessage({event:e.STORAGE_SET,key:t,value:n})};Get=async t=>{const n=new Promise(((e,t)=>{const n=t=>{this.storagePort.onMessage.removeListener(n),e(t)};this.storagePort.onMessage.addListener(n)}));return this.storagePort.postMessage({event:e.STORAGE_GET,key:t}),console.log(this.storagePort),n}},i=class{sessionId=null;url=null;primaryOfferIndex=null;primaryPeerConnection=null;constructor(e=null,t="",n=null,r=null){this.sessionId=e,this.url=t,this.primaryPeerConnection=n,this.primaryOfferIndex=r}SetPrimaryPeerConnection=e=>{this.primaryPeerConnection=e}},s=class{apiEndpoint=null;constructor(){this.apiEndpoint="https://decentralized-experience-synchronization.onrender.com"}createNewSession=async()=>{try{const e=await fetch(`${this.apiEndpoint}/session/create`,{method:"POST"});if(!e.ok)throw new Error(`Response status: ${e.status}`,e);const t=await e.json();return console.log(t),t.sessionId}catch(e){console.error(e.message)}};answerConnectionRequest=async(e,t)=>{const n=await fetch(`${this.apiEndpoint}/session/access/${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});if(!n.ok)throw new Error(`Response status: ${n.status}`,n)}};var a=n(518);const c=class{apiEndpoint=null;sessionId=null;socket=null;constructor(e=""){this.apiEndpoint="https://decentralized-experience-synchronization.onrender.com",this.sessionId=e,e&&this.establishConnection()}establishConnection=()=>{console.log(a),this.socket=a(`${this.apiEndpoint}/${this.sessionId}`)};registerAnswerHandler(e){this.socket.on("answer",(async t=>e(JSON.parse(t))))}push=e=>{this.socket.emit("offer",JSON.stringify(e))}},u=class{static sleep=e=>new Promise((t=>setTimeout(t,e)));static throttledRetry=async e=>{for(let t=0;t<5;t++){let n=e();if(n)return n;await sleep(500*t)}console.log("All retry attempts exhausted!")}},h=class{PEER_LIMIT=5;peerId=null;connections=[];offers=[];answers=[];session=null;server=null;signallingServer=null;chromeStorage=null;connectedCount=null;constructor(){this.peerId=Date.now(),this.server=new s;try{this.chromeStorage=new o}catch(e){}}instantiate=async e=>{if(window.location.origin.includes("decentralized-experience-synchronization.onrender.com")||window.location.origin.includes("decentralized-experience-synchronization.onrender.com"))await this.SaveConnectionAssetsAndProceed();else{const t=e??await this.ConnectionAssetsExist();t?(this.isPrimary=!1,await this.AnswerSessionRequest(t)):this.isPrimary=!0}return this};InstantiateSession=async()=>{let e=await this.server.createNewSession();this.session=new i(e,window.location.href),this.signallingServer=new c(e),this.signallingServer.registerAnswerHandler(this.CompleteHandshake)};CreateSessionRequest=async(e=null)=>{await this.InstantiateSession();for(let t=0;t<(e??this.PEER_LIMIT);t++)await this.CreateConnectionRequest(!0,t);await this.signallingServer.push({sessionId:this.session.sessionId,url:this.session.url??window.location.href,connections:this.connections.map((e=>({offer:e.offer?JSON.stringify(e.offer):null,answer:e.answer?JSON.stringify(e.answer):null})))})};CreateConnectionRequest=async(e=!1,t)=>{const n=new r(e);n.SetChannelOnOpenAction((()=>this.channelOnOpenHandler(t))).SetChannelOnMessageAction(this.channelOnMessageHandler).SetChannelOnCloseAction(this.channelOnCloseHandler);const o=await n.Offer(this.peerId,t);return this.offers.push(o),this.answers.push(null),this.connections.push(n),o};SaveConnectionAssetsAndProceed=()=>{const e=window.location.pathname.split("/").filter((e=>e)).slice(-1)[0],t=document.getElementById("session-url").value,n=document.getElementById("offer-sdp").value,r=document.getElementById("offer-index").value;this.chromeStorage.Set(t,{sessionId:e,url:t,offer:n,offerIndex:r}),window.location.replace(t)};ConnectionAssetsExist=async()=>await this.chromeStorage.Get(window.location.href);AnswerSessionRequest=async e=>{const{sessionId:t,url:n,offer:r,offerIndex:o}=e;this.session=new i(t,n);const s=await this.CreateConnectionResponse(r,!0);await this.server.answerConnectionRequest(t,{answer:JSON.stringify(s),offerIndex:Number(o)})};CompleteHandshake=async e=>{const{answer:t,offerIndex:n}=e,r=this.connections[n];this.answers[n]=await r.Answer(JSON.parse(t))};CreateConnectionResponse=async(e,t=!1)=>{const n=new r(t);n.SetChannelOnOpenAction((()=>this.channelOnOpenHandler(this.connections.length))).SetChannelOnMessageAction(this.channelOnMessageHandler).SetChannelOnCloseAction(this.channelOnCloseHandler);const o=await n.Answer(JSON.parse(e));return this.answers.push(o),this.connections.push(n),t&&this.session.SetPrimaryPeerConnection(n),o};channelOnOpenHandler=async t=>{this.connectedCount+=1,console.log("Channel Opened!",t),this.isPrimary?(await u.sleep(5e3),window.dispatchEvent(new CustomEvent("MESSAGE:CLIENT",{detail:{event:e.PEER_CONNECTED,getStatus:this.isPrimary}})),this.connectedCount>1&&this.sendSelfOrganizingOfferRequests(t)):window.dispatchEvent(new CustomEvent("MESSAGE:CLIENT",{detail:{event:e.PEER_CONNECTED,getStatus:this.isPrimary}}))};channelOnCloseHandler=async()=>{this.connectedCount-=1,console.log("Channel Closed!")};channelOnMessageHandler=async t=>{switch(console.log("Message Received:",t),t.event){case e.REMOTE_STREAM_MANIPULATED_EVENT:window.dispatchEvent(new CustomEvent("MESSAGE:CLIENT",{detail:t}));break;case e.SELF_ORGANIZING_OFFER_RESPONSE:this.sendSelfOrganizingAnswerRequests(t.offers,t.connectionIndex);break;case e.SELF_ORGANIZING_ANSWER_RESPONSE:this.sendSelfOrganizingHandshakeCompletionRequest(t.answer,t.connectionIndex,t.offerIndex);break;case e.SELF_ORGANIZING_OFFER_REQUEST:await this.answerSelfOrganizingOfferRequest(t.connectionIndex);break;case e.SELF_ORGANIZING_ANSWER_REQUEST:await this.answerSelfOrganizingAnswerRequest(t.offer,t.connectionIndex,t.offerIndex);break;case e.SELF_ORGANIZING_CONNECTION_REQUEST:await this.CompleteHandshake(t);break;default:console.log("No listener found:",t)}};SendToPrimary=e=>{if(!this.session||!this.session.primaryPeerConnection)return null;this.session.primaryPeerConnection.Send(e)};Broadcast=e=>{this.connections.forEach((t=>t.connected?t.Send(e):null))};sendSelfOrganizingOfferRequests=t=>{this.connections[t].connected&&this.connections[t].Send({event:e.SELF_ORGANIZING_OFFER_REQUEST,connectionIndex:t})};sendSelfOrganizingAnswerRequests=(t,n)=>{for(let r=0;r<n;r++)this.connections[r].connected&&this.connections[r].Send({event:e.SELF_ORGANIZING_ANSWER_REQUEST,offer:t[r],offerIndex:r+1,connectionIndex:n})};sendSelfOrganizingHandshakeCompletionRequest=(t,n,r)=>{this.connections[n].connected&&this.connections[n].Send({event:e.SELF_ORGANIZING_CONNECTION_REQUEST,answer:t,offerIndex:r})};answerSelfOrganizingOfferRequest=async t=>{for(let e=0;e<t;e++)await this.CreateConnectionRequest(!1,e);this.SendToPrimary({event:e.SELF_ORGANIZING_OFFER_RESPONSE,offers:this.offers.map((e=>JSON.stringify(e))),connectionIndex:t})};answerSelfOrganizingAnswerRequest=async(t,n,r)=>{const o=await this.CreateConnectionResponse(t,!1);this.SendToPrimary({event:e.SELF_ORGANIZING_ANSWER_RESPONSE,answer:JSON.stringify(o),offerIndex:r,connectionIndex:n})}};var f=0,l={},p=null;window.addEventListener("load",(async()=>{document.getElementById("create-session").addEventListener("click",(async()=>await d())),document.getElementById("add-peer").addEventListener("click",(async()=>await y()))}));const d=async(e=!0)=>{const t=Number(document.getElementById("peers").value);let n=performance.now();const r=await(new h).instantiate("");await r.CreateSessionRequest(t);let o=performance.now()-n;return console.log(`Execution time for ${t} peers capacity: ${o} milliseconds`),e&&r.connections.forEach((e=>{e.peerConnection.close()})),l[t]=o,console.log(l),r.session.sessionId},y=async()=>{p||(p=await d(!1));const e="http://localhost:8080/session/access/"+p;try{const n=await fetch(e,{method:"GET"});if(!n.ok)throw new Error(`Response status: ${n.status}`,n);const r=(await n.text()).replace(/value=([^"'\s>]+)/g,'value="$1"').replace(/type=\s*"?\s*hidden\s*"?/g,'type="hidden"');var t=(new DOMParser).parseFromString(r,"text/html");const o=t.getElementById("offer-sdp").value,i=t.getElementById("offer-index").value;localStorage.setItem("session_id",p),localStorage.setItem("offer_sdp",o),localStorage.setItem("offer_index",i),window.open("http://localhost:8888/inclusion","newWindow-"+f++,"width=400,height=300")}catch(e){console.error(e.message)}}})()})();